$.fn.isInViewport=function(){var elementTop=$(this).offset().top;var elementBottom=elementTop+$(this).outerHeight();var viewportTop=$(window).scrollTop();var viewportBottom=viewportTop+$(window).height();return elementBottom>viewportTop&&elementTop<viewportBottom};function CircleBar(){var circleBarDOM=undefined;var circleDOM=$('<div class="bgBar"></div><svg class="circle"><circle class="bgBar"/><circle class="bar"/></svg>');var barDOM=circleDOM.find(".bar");var bgBarDOM=circleDOM.find(".bgBar");var infosCtner=$('<div class="infos-ctner"></div>');var pourcDOM=$('<div class="pourcentage"></div>');var textDOM=$('<div class="text"></div>');var value=0;var transition={bar:[],bgBar:[]};var opts={lineColor:"#307bbb",lineWidth:"10",diameter:"100",lineTransitionHover:"500ms",viewPourcentage:!0};function init(_elem,_opts,_value){circleBarDOM=$(_elem);circleBarDOM.empty();value=_value;$.extend(opts,_opts);circleBarDOM.addClass("circle-bar");createCircle();createInfosCtner()}
function createInfosCtner(){if(opts.viewPourcentage)viewPourcentage();if(opts.text)setText();if(opts.textCSS)setTextCSS();if(opts.pourcentageCSS)setPourcentageCSS();circleBarDOM.append(infosCtner)}
function createCircle(){setLineWidth();if(opts.bgLineWidth)setBgLineWidth();if(opts.lineWidthHover)setLineWidthHover();setDiameter();setLineColor();if(opts.lineBgColor)setLineBgColor();if(opts.backgroundColor)setBgColor();if(opts.lineDuration)setLineDuration();if(opts.lineDelay)setLineDelay();setLineTransitionHover();circleBarDOM.append(circleDOM)
setValue()}
function setText(_text){if(_text)opts.text=_text;textDOM.text(opts.text);if(infosCtner.find(textDOM).length==0)infosCtner.append(textDOM)}
function viewPourcentage(_bool){if(_bool)opts.viewPourcentage=_bool;pourcDOM.text(value+'%');if(infosCtner.find(pourcDOM).length==0)infosCtner.append(pourcDOM)}
function setValue(_val){if(_val)value=_val;$(window).on('resize scroll load',function(){if(circleBarDOM.isInViewport()){animate()}else{}});if(_val)animate()}
function animate(){var _dasharray=2*Math.PI*((opts.diameter/2)-opts.lineWidth);barDOM.css("stroke-dashoffset",_dasharray-((_dasharray/100)*value));if(opts.viewPourcentage)viewPourcentage()}
function setLineColor(_lineColor){if(_lineColor)opts.lineColor=_lineColor;barDOM.css("stroke",opts.lineColor)}
function setLineBgColor(_lineBgColor){if(_lineBgColor)opts.lineBgColor=_lineBgColor;bgBarDOM.css("stroke",opts.lineBgColor)}
function setBgColor(_bgColor){if(_bgColor)opts.backgroundColor=_bgColor;bgBarDOM.css("fill",opts.backgroundColor)}
function setTextCSS(_css){if(_css)opts.textCSS=_css;textDOM.css(opts.textCSS)}
function setPourcentageCSS(_css){if(_css)opts.pourcentageCSS=_css;pourcDOM.css(opts.pourcentageCSS)}
function setTextHoverCSS(_css){if(_css)opts.textHoverCSS=_css}
function setPourcentageHoverCSS(_css){if(_css)opts.pourcentageHoverCSS=_css}
function initTransition(){var _transitionStr="";for(var i=0;i<transition.bar.length;i++){_transitionStr+=(_transitionStr==""?"":",")+transition.bar[i].name+" "+transition.bar[i].value}
barDOM.css("transition",_transitionStr);var _transitionStr="";for(var i=0;i<transition.bgBar.length;i++){_transitionStr+=(_transitionStr==""?"":",")+transition.bgBar[i].name+" "+transition.bgBar[i].value}
bgBarDOM.css("transition",_transitionStr)}
function setLineWidth(_lineWidth){if(_lineWidth)opts.lineWidth=_lineWidth;barDOM.attr("stroke-width",opts.lineWidth)}
function setBgLineWidth(_bgLineWidth){if(_bgLineWidth)opts.bgLineWidth=_bgLineWidth;bgBarDOM.attr("stroke-width",opts.bgLineWidth)}
function setLineWidthHover(_lineWidthHover){if(_lineWidthHover)opts.lineWidthHover=_lineWidthHover;initHover()}
function setbgLineWidthHover(_bgLineWidthHover){if(_bgLineWidthHover)opts.bgLineWidthHover=_bgLineWidthHover;initHover()}
function initHover(){circleBarDOM.hover(function(){if(opts.lineWidthHover)barDOM.css("stroke-width",opts.lineWidthHover);if(opts.bgLineWidthHover)bgBarDOM.css("stroke-width",opts.bgLineWidthHover);if(opts.textHoverCSS)textDOM.css(opts.textHoverCSS);if(opts.pourcentageHoverCSS)pourcDOM.css(opts.pourcentageHoverCSS)},function(){if(opts.lineWidthHover)barDOM.css("stroke-width",opts.lineWidth);if(opts.bgLineWidthHover)bgBarDOM.css("stroke-width",opts.bgLineWidth);if(opts.textHoverCSS)textDOM.css(opts.textCSS);if(opts.pourcentageHoverCSS)pourcDOM.css(opts.pourcentageCSS)})}
function setLineDuration(_lineDuration){if(_lineDuration)opts.lineDuration=_lineDuration;setTransitionDashoffset()}
function setLineDelay(_lineDelay){if(_lineDelay)opts.lineDelay=_lineDelay;if(!opts.lineDuration)opts.lineDuration="1s";setTransitionDashoffset()}
function setTransitionDashoffset(){transition.bar.push({name:"stroke-dashoffset",value:opts.lineDuration+" "+(opts.lineDelay?opts.lineDelay:"")});initTransition()}
function setLineTransitionHover(_lineTransitionHover){if(_lineTransitionHover)opts.lineTransitionHover=_lineTransitionHover;transition.bar.push({name:"stroke-width",value:opts.lineTransitionHover});transition.bgBar.push({name:"stroke-width",value:opts.lineTransitionHover});pourcDOM.css('transition','all '+opts.lineTransitionHover);textDOM.css('transition','all '+opts.lineTransitionHover);initTransition()}
function setDiameter(_diameter){if(_diameter)opts.diameter=_diameter;circleBarDOM.css("width",opts.diameter+"px");circleBarDOM.css("height",opts.diameter+"px");circleDOM.css("width",opts.diameter+"px");circleDOM.css("height",opts.diameter+"px");barDOM.attr("r",((opts.diameter/2)-opts.lineWidth));barDOM.attr("cx",(opts.diameter/2));barDOM.attr("cy",(opts.diameter/2));barDOM.css("stroke-dasharray",2*Math.PI*((opts.diameter/2)-opts.lineWidth));barDOM.css("stroke-dashoffset",2*Math.PI*((opts.diameter/2)-opts.lineWidth));bgBarDOM.attr("r",((opts.diameter/2)-opts.lineWidth));bgBarDOM.attr("cx",(opts.diameter/2));bgBarDOM.attr("cy",(opts.diameter/2));bgBarDOM.css("stroke-dasharray",2*Math.PI*((opts.diameter/2)-opts.lineWidth))}
function getValue(){return value}
function getOpts(){return opts}
return{"init":function(_elem,_opts,_value){init(_elem,_opts,_value)},"getValue":function(){return getValue()},"getOpts":function(){return getOpts()},"setText":function(_text){setText(_text)},"setValue":function(_val){setValue(_val)},"setLineColor":function(_lineColor){setLineColor(_lineColor)},"setLineBgColor":function(_lineBgColor){setLineBgColor(_lineBgColor)},"setBgColor":function(_bgColor){setBgColor(_bgColor)},"setLineWidth":function(_lineWidth){setLineWidth(_lineWidth)},"setBgLineWidth":function(_bgLineWidth){setBgLineWidth(_bgLineWidth)},"setLineDuration":function(_lineDuration){setLineDuration(_lineDuration)},"setLineDelay":function(_lineDelay){setLineDelay(_lineDelay)},"setLineWidthHover":function(_lineWidthHover){setLineWidthHover(_lineWidthHover)},"setbgLineWidthHover":function(_bgLineWidthHover){setbgLineWidthHover(_bgLineWidthHover)},"setLineTransitionHover":function(_lineTransitionHover){setLineTransitionHover(_lineTransitionHover)},"viewPourcentage":function(_bool){viewPourcentage(_bool)},"setTextCSS":function(_css){setTextCSS(_css)},"setTextHoverCSS":function(_css){setTextHoverCSS(_css)},"setPourcentageCSS":function(_css){setPourcentageCSS(_css)},"setPourcentageHoverCSS":function(_css){setPourcentageHoverCSS(_css)}}}